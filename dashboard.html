<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Produção</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

<style>
body{
  margin:0;
  background:#060f1f;
  font-family:Segoe UI, Tahoma, sans-serif;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container{
  width:1180px;
  background:radial-gradient(circle at top,#0e2444,#050b18);
  border-radius:26px;
  padding:34px 44px;
  box-shadow:0 0 50px rgba(0,0,0,.7);
  position:relative;
}
h1{
  text-align:center;
  font-size:64px;
  letter-spacing:12px;
  margin:10px 0 22px;
}
.status-box{
  position:absolute;
  top:36px;
  right:48px;
  border:2px solid #fff;
  padding:16px 28px;
  border-radius:20px;
  font-weight:800;
  text-align:center;
  line-height:1.3;
}
.legend{
  display:flex;
  justify-content:center;
  gap:56px;
  margin-bottom:24px;
  font-weight:800;
  font-size:18px;
}
.legend span{
  display:flex;
  align-items:center;
  gap:12px;
}
.dot{
  width:18px;
  height:18px;
  border-radius:50%;
}
.p{background:#4cc3d9}
.r{background:#9fbad5}
.d{background:#ffd83d}

.charts{
  display:flex;
  align-items:center;
  justify-content:space-between;
}
#barBox{
  width:760px;
  height:420px;
}
#donutBox{
  width:220px;
  height:220px;
  position:relative;
}
#percent{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:44px;
  font-weight:900;
  color:#1aff1a;
}
</style>
</head>

<body>
<div class="container">

  <h1>CAIXAS</h1>

  <div class="status-box">
    PRODUÇÃO FINALIZADA<br>
    <span id="hora">--:--</span>
  </div>

  <div class="legend">
    <span><div class="dot p"></div>PROGRAMADO</span>
    <span><div class="dot r"></div>PRODUZIDO</span>
    <span><div class="dot d"></div>DIFERENÇA</span>
  </div>

  <div class="charts">
    <div id="barBox">
      <canvas id="barChart"></canvas>
    </div>

    <div id="donutBox">
      <canvas id="donutChart"></canvas>
      <div id="percent">0%</div>
    </div>
  </div>

</div>

<script>
/* ===== DADOS ===== */
const dados = JSON.parse(localStorage.getItem("dadosProducao"));
if(!dados){
  alert("Sem dados de produção");
  location.href="dados.html";
}

/* ===== HORA ===== */
document.getElementById("hora").textContent =
  new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});

/* ===== LÓGICA DO SLIDE ===== */
const programado = Number(dados.programado);
const produzidoReal = Number(dados.produzido);

const produzido = Math.min(produzidoReal, programado);
const diferenca = Math.max(programado - produzidoReal, 0);

let percentual = programado > 0 ? (produzidoReal / programado) * 100 : 0;
percentual = Math.max(0, Math.min(100, percentual));

/* ===== BAR CHART ===== */
new Chart(document.getElementById('barChart'),{
  type:'bar',
  data:{
    labels:['','',''],
    datasets:[{
      data:[programado, produzido, diferenca],
      backgroundColor:['#4cc3d9','#9fbad5','#ffd83d'],
      borderRadius:26,
      borderSkipped:false
    }]
  },
  options:{
    responsive:true,
    plugins:{
      legend:{display:false},
      tooltip:{enabled:false},
      datalabels:{
        color:'#ffffff',
        font:{
          weight:'900',
          size:18
        },
        anchor:'end',
        align:'end',
        offset:10,
        formatter:value => value.toLocaleString('pt-BR')
      }
    },
    scales:{
      y:{
        beginAtZero:true,
        ticks:{
          color:'#ffffff',
          font:{size:14}
        },
        grid:{color:'rgba(255,255,255,0.08)'}
      },
      x:{
        ticks:{display:false},
        grid:{display:false}
      }
    }
  },
  plugins:[ChartDataLabels]
});

/* ===== DONUT ===== */
new Chart(document.getElementById('donutChart'),{
  type:'doughnut',
  data:{
    datasets:[{
      data:[percentual,100-percentual],
      backgroundColor:['#1aff1a','#1a2a3a'],
      borderWidth:0
    }]
  },
  options:{
    cutout:'78%',
    plugins:{legend:{display:false},tooltip:{enabled:false}}
  }
});

document.getElementById('percent').textContent =
  Math.round(percentual) + '%';
</script>
</body>
</html>
