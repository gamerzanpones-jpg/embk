<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Dashboard Produção - Sequencial Moderno</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

<style>
body {
  margin:0;
  background:#0b1f2d;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color:#e1e7ee;
  padding:20px;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container {
  background:#142b44;
  border-radius:12px;
  padding:30px;
  width:900px;
  box-shadow:0 0 30px rgba(0,0,0,0.5);
  position:relative;
  display:flex;
  flex-direction:column;
  gap:20px;
  user-select:none;
}
h1,h2 {
  text-align:center;
  font-weight:900;
  letter-spacing:4px;
  margin:0 0 20px 0;
}
h1{font-size:36px;}
h2{font-size:28px;}
.status-box {
  position:absolute;
  top:30px;
  right:30px;
  border:2px solid #e1e7ee;
  border-radius:12px;
  padding:12px 22px;
  font-weight:600;
  font-size:16px;
  text-align:center;
}

/* --- Colaboradores --- */
#tela1{display:flex;flex-direction:column;gap:24px;}
.cards{display:flex;justify-content:center;gap:18px;flex-wrap:wrap;}
.card{
  flex:1 1 160px;
  max-width:180px;
  border-radius:10px;
  padding:24px 15px;
  text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  color:white;
  transition:background-color 0.3s ease;
  cursor:default;
  font-weight:700;
  font-size:18px;
  font-family:'Segoe UI Black','Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
}
.card span{display:block;font-size:42px;font-weight:900;margin-top:10px;}
.ideal{background:#455a64;}
.falta{background:#d32f2f;}
.atestado{background:#f57c00;}
.ferias{background:#388e3c;}
.card:not(.ideal):not(.falta):not(.atestado):not(.ferias){background:#1976d2;}
.card:hover{filter:brightness(85%);}

/* --- Produção --- */
#tela2{display:none;flex-direction:column;gap:20px;align-items:center;position:relative;}

.color-key {
  display:flex;
  justify-content:center;
  gap:60px;
  width:100%;
  margin-bottom:10px;
}
.color-item {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
  font-weight:700;
  font-size:14px;
}
.color-square {
  width:20px;
  height:20px;
  border-radius:4px;
  border:2px solid white;
}
.programado{background:#26c6da;}
.produzido{background:#90caf9;}
.diferenca{background:#fbc02d;}

.charts-row{display:flex;align-items:center;gap:40px;width:100%;justify-content:flex-start;}
#barChart{width:570px !important;height:320px !important;position:relative;}
#donutChartContainer{position:relative;width:130px;height:130px;}
#donutChart{width:130px !important;height:130px !important;}
#percentText{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:28px;font-weight:700;color:#1de9b6;pointer-events:none;user-select:none;}

/* Números abaixo das barras, centralizados com a barra */
#barChartValues {
  display:flex;
  justify-content:space-between;
  width:570px;
  margin-top:12px;
  color:#e1e7ee;
  font-weight:700;
  font-size:16px;
  padding: 0 6px; /* para alinhar melhor com borda das barras */
}
.nav{margin-top:30px;display:flex;justify-content:space-between;}
button{
  background:#26c6da;
  border:none;
  border-radius:6px;
  padding:12px 28px;
  color:#0b1f2d;
  font-weight:700;
  font-size:16px;
  cursor:pointer;
  transition:background-color 0.25s ease;
  box-shadow:0 3px 8px rgba(0,0,0,0.2);
}
button:hover{background:#00acc1;color:#fff;}
</style>
</head>
<body>
<div class="container">

  <!-- Tela 1 - Colaboradores -->
  <div id="tela1">
    <h2>COLABORADORES</h2>
    <div class="cards">
      <div class="card ideal">Ideal<span>30</span></div>
      <div class="card">Efetivo<span id="cardEfetivo">0</span></div>
      <div class="card falta">Faltas<span id="cardFalta">0</span></div>
      <div class="card atestado">Atestados<span id="cardAtestado">0</span></div>
      <div class="card ferias">Férias<span id="cardFerias">0</span></div>
    </div>
    <div class="nav" style="justify-content:center;margin-top:24px;">
      <button onclick="avancar()">Avançar ▶</button>
    </div>
  </div>

  <!-- Tela 2 - Produção -->
  <div id="tela2">
    <h1>CAIXAS</h1>

    <div class="status-box" id="statusBox">
      N/D
    </div>

    <!-- Quadrados coloridos com texto acima do gráfico -->
    <div class="color-key">
      <div class="color-item"><div class="color-square programado"></div>Programado</div>
      <div class="color-item"><div class="color-square produzido"></div>Produzido</div>
      <div class="color-item"><div class="color-square diferenca"></div>Diferença</div>
    </div>

    <div class="charts-row">
      <div>
        <canvas id="barChart"></canvas>
        <!-- Números das caixas abaixo das barras -->
        <div id="barChartValues">
          <span id="valProgramado">0</span>
          <span id="valProduzido">0</span>
          <span id="valDiferenca">0</span>
        </div>
      </div>
      <div id="donutChartContainer">
        <canvas id="donutChart"></canvas>
        <div id="percentText">0%</div>
      </div>
    </div>

    <div class="nav">
      <button onclick="voltar()">◀ Voltar</button>
      <button onclick="location.href='menu.html'">Menu</button>
    </div>
  </div>

</div>

<script>
const dados = JSON.parse(localStorage.getItem("dadosProducao"));
if(!dados){alert("Nenhum dado encontrado. Preencha os dados primeiro."); window.location.href="dados.html";}

document.getElementById("cardEfetivo").textContent = dados.efetivo;
document.getElementById("cardFalta").textContent = dados.falta;
document.getElementById("cardAtestado").textContent = dados.atestado;
document.getElementById("cardFerias").textContent = dados.ferias;

function avancar(){document.getElementById('tela1').style.display='none'; document.getElementById('tela2').style.display='flex'; atualizarGrafico();}
function voltar(){document.getElementById('tela2').style.display='none'; document.getElementById('tela1').style.display='flex';}

let barChart, donutChart;

function atualizarGrafico(){
  const ctxBar = document.getElementById('barChart').getContext('2d');
  const ctxDonut = document.getElementById('donutChart').getContext('2d');
  const percentText = document.getElementById('percentText');

  const programado = dados.programado;
  const produzido = dados.produzido;
  const diferenca = Math.abs(produzido - programado);

  let percentual = 0;
  if(programado>0) percentual = Math.min(100, Math.max(0, (produzido/programado)*100));

  percentText.textContent = '0%';
  if(barChart) barChart.destroy();
  if(donutChart) donutChart.destroy();

  // --- Gráfico de Barras sem números internos ---
  barChart = new Chart(ctxBar, {
    type:'bar',
    data:{
      labels:['','',''], // deixamos labels vazias
      datasets:[{
        data:[programado, produzido, diferenca],
        backgroundColor:['#26c6da','#90caf9','#fbc02d'],
        borderRadius:6,
        borderSkipped:false
      }]
    },
    options:{
      responsive:true,
      animation:{ duration:800 },
      plugins:{ 
        legend:{ display:false }, 
        tooltip:{ enabled:true }, 
        datalabels:{ display:false } // números internos desativados
      },
      scales:{
        y:{ beginAtZero:true, ticks:{ color:'#e1e7ee', font:{ size:14 } }, grid:{ color:'#16405a' } },
        x:{ ticks:{ display:false }, grid:{ display:false } } // x sem labels
      }
    },
    plugins:[ChartDataLabels]
  });

  // --- Atualizar apenas os números das caixas abaixo das barras ---
  document.getElementById('valProgramado').textContent = programado.toLocaleString('pt-BR');
  document.getElementById('valProduzido').textContent = produzido.toLocaleString('pt-BR');
  document.getElementById('valDiferenca').textContent = diferenca.toLocaleString('pt-BR');

  // --- Gráfico de Rosca ---
  donutChart = new Chart(ctxDonut,{
    type:'doughnut',
    data:{ labels:['Feito','Faltante'], datasets:[{ data:[percentual,100-percentual], backgroundColor:['#1de9b6','#144d56'], borderWidth:0 }]},
    options:{ cutout:'75%', responsive:true, animation:{ animateRotate:true, duration:1200 }, plugins:{ legend:{ display:false }, tooltip:{ enabled:false } } }
  });

  let currentPercent=0;
  const targetPercent=Math.round(percentual);
  const step=targetPercent>0?Math.max(1,Math.floor(targetPercent/60)):1;
  function animatePercent(){ 
    if(currentPercent<targetPercent){ 
      currentPercent+=step; 
      if(currentPercent>targetPercent) currentPercent=targetPercent; 
      percentText.textContent=currentPercent+'%'; 
      requestAnimationFrame(animatePercent);
    }else{ 
      percentText.textContent=targetPercent+'%';
    } 
  }
  animatePercent();
}

document.getElementById('tela1').style.display='flex';
document.getElementById('tela2').style.display='none';
</script>
</body>
</html>
